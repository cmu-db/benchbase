-- DROP TABLE

BEGIN EXECUTE IMMEDIATE 'DROP TABLE CONFIG_PROFILE'; EXCEPTION WHEN OTHERS THEN IF SQLCODE != -942 THEN RAISE; END IF; END;;
BEGIN EXECUTE IMMEDIATE 'DROP TABLE CONFIG_HISTOGRAMS'; EXCEPTION WHEN OTHERS THEN IF SQLCODE != -942 THEN RAISE; END IF; END;;
BEGIN EXECUTE IMMEDIATE 'DROP TABLE AIRPORT_DISTANCE'; EXCEPTION WHEN OTHERS THEN IF SQLCODE != -942 THEN RAISE; END IF; END;;
BEGIN EXECUTE IMMEDIATE 'DROP TABLE FREQUENT_FLYER'; EXCEPTION WHEN OTHERS THEN IF SQLCODE != -942 THEN RAISE; END IF; END;;
BEGIN EXECUTE IMMEDIATE 'DROP TABLE RESERVATION'; EXCEPTION WHEN OTHERS THEN IF SQLCODE != -942 THEN RAISE; END IF; END;;
BEGIN EXECUTE IMMEDIATE 'DROP TABLE AIRLINE CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN IF SQLCODE != -942 THEN RAISE; END IF; END;;
BEGIN EXECUTE IMMEDIATE 'DROP TABLE FLIGHT'; EXCEPTION WHEN OTHERS THEN IF SQLCODE != -942 THEN RAISE; END IF; END;;
BEGIN EXECUTE IMMEDIATE 'DROP TABLE CUSTOMER'; EXCEPTION WHEN OTHERS THEN IF SQLCODE != -942 THEN RAISE; END IF; END;;
BEGIN EXECUTE IMMEDIATE 'DROP TABLE AIRPORT'; EXCEPTION WHEN OTHERS THEN IF SQLCODE != -942 THEN RAISE; END IF; END;;
BEGIN EXECUTE IMMEDIATE 'DROP TABLE COUNTRY'; EXCEPTION WHEN OTHERS THEN IF SQLCODE != -942 THEN RAISE; END IF; END;;
--
CREATE TABLE CONFIG_PROFILE (
    CFP_SCALE_FACTOR            FLOAT NOT NULL,
    CFP_AIPORT_MAX_CUSTOMER     CLOB NOT NULL,
    CFP_FLIGHT_START            TIMESTAMP NOT NULL,
    CFP_FLIGHT_UPCOMING         TIMESTAMP NOT NULL,
    CFP_FLIGHT_PAST_DAYS        INT NOT NULL,
    CFP_FLIGHT_FUTURE_DAYS      INT NOT NULL,
    CFP_FLIGHT_OFFSET           INT,
    CFP_RESERVATION_OFFSET      INT,
    CFP_NUM_RESERVATIONS        INT NOT NULL,
    CFP_CODE_IDS_XREFS          CLOB NOT NULL
);

--
-- CONFIG_HISTOGRAMS
--
CREATE TABLE CONFIG_HISTOGRAMS (
    CFH_NAME             VARCHAR2(128) NOT NULL,
    CFH_DATA             CLOB NOT NULL,
    CFH_IS_AIRPORT       NUMBER(3,0) DEFAULT 0,
    PRIMARY KEY (CFH_NAME)
);

-- 
-- COUNTRY
--
CREATE TABLE COUNTRY (
    CO_ID        NUMBER(19,0) NOT NULL,
    CO_NAME      VARCHAR2(64) NOT NULL,
    CO_CODE_2    VARCHAR2(2) NOT NULL,
    CO_CODE_3    VARCHAR2(3) NOT NULL,
    PRIMARY KEY (CO_ID)
);

--
-- AIRPORT
--
CREATE TABLE AIRPORT (
    AP_ID          NUMBER(19,0) NOT NULL,
    AP_CODE        VARCHAR2(3) NOT NULL,
    AP_NAME        VARCHAR2(128) NOT NULL,
    AP_CITY        VARCHAR2(64) NOT NULL,
    AP_POSTAL_CODE VARCHAR2(12),
    AP_CO_ID       NUMBER(19,0) NOT NULL REFERENCES COUNTRY (CO_ID),
    AP_LONGITUDE   FLOAT,
    AP_LATITUDE    FLOAT,
    AP_GMT_OFFSET  FLOAT,
    AP_WAC         NUMBER(19,0),
    AP_IATTR00     NUMBER(19,0),
    AP_IATTR01     NUMBER(19,0),
    AP_IATTR02     NUMBER(19,0),
    AP_IATTR03     NUMBER(19,0),
    AP_IATTR04     NUMBER(19,0),
    AP_IATTR05     NUMBER(19,0),
    AP_IATTR06     NUMBER(19,0),
    AP_IATTR07     NUMBER(19,0),
    AP_IATTR08     NUMBER(19,0),
    AP_IATTR09     NUMBER(19,0),
    AP_IATTR10     NUMBER(19,0),
    AP_IATTR11     NUMBER(19,0),
    AP_IATTR12     NUMBER(19,0),
    AP_IATTR13     NUMBER(19,0),
    AP_IATTR14     NUMBER(19,0),
    AP_IATTR15     NUMBER(19,0),
    PRIMARY KEY (AP_ID)
);

--
-- AIRPORT_DISTANCE
--
CREATE TABLE AIRPORT_DISTANCE (
    D_AP_ID0       NUMBER(19,0) NOT NULL REFERENCES AIRPORT (AP_ID),
    D_AP_ID1       NUMBER(19,0) NOT NULL REFERENCES AIRPORT (AP_ID),
    D_DISTANCE     FLOAT NOT NULL,
    PRIMARY KEY (D_AP_ID0, D_AP_ID1)
);

--
-- AIRLINE
--
CREATE TABLE AIRLINE (
    AL_ID          NUMBER(19,0) NOT NULL,
    AL_IATA_CODE   VARCHAR2(3),
    AL_ICAO_CODE   VARCHAR2(3),
    AL_CALL_SIGN   VARCHAR2(32),
    AL_NAME        VARCHAR2(128) NOT NULL,
    AL_CO_ID       NUMBER(19,0) NOT NULL REFERENCES COUNTRY (CO_ID),
    AL_IATTR00     NUMBER(19,0),
    AL_IATTR01     NUMBER(19,0),
    AL_IATTR02     NUMBER(19,0),
    AL_IATTR03     NUMBER(19,0),
    AL_IATTR04     NUMBER(19,0),
    AL_IATTR05     NUMBER(19,0),
    AL_IATTR06     NUMBER(19,0),
    AL_IATTR07     NUMBER(19,0),
    AL_IATTR08     NUMBER(19,0),
    AL_IATTR09     NUMBER(19,0),
    AL_IATTR10     NUMBER(19,0),
    AL_IATTR11     NUMBER(19,0),
    AL_IATTR12     NUMBER(19,0),
    AL_IATTR13     NUMBER(19,0),
    AL_IATTR14     NUMBER(19,0),
    AL_IATTR15     NUMBER(19,0),
    PRIMARY KEY (AL_ID)
);

--
-- CUSTOMER
--
CREATE TABLE CUSTOMER (
    C_ID           NUMBER(19,0) NOT NULL,
    C_ID_STR       VARCHAR2(64) UNIQUE NOT NULL,
    C_BASE_AP_ID   NUMBER(19,0) REFERENCES AIRPORT (AP_ID),
    C_BALANCE      FLOAT NOT NULL,
    C_SATTR00      VARCHAR2(32),
    C_SATTR01      VARCHAR2(8),
    C_SATTR02      VARCHAR2(8),
    C_SATTR03      VARCHAR2(8),
    C_SATTR04      VARCHAR2(8),
    C_SATTR05      VARCHAR2(8),
    C_SATTR06      VARCHAR2(8),
    C_SATTR07      VARCHAR2(8),
    C_SATTR08      VARCHAR2(8),
    C_SATTR09      VARCHAR2(8),
    C_SATTR10      VARCHAR2(8),
    C_SATTR11      VARCHAR2(8),
    C_SATTR12      VARCHAR2(8),
    C_SATTR13      VARCHAR2(8),
    C_SATTR14      VARCHAR2(8),
    C_SATTR15      VARCHAR2(8),
    C_SATTR16      VARCHAR2(8),
    C_SATTR17      VARCHAR2(8),
    C_SATTR18      VARCHAR2(8),
    C_SATTR19      VARCHAR2(8),
    C_IATTR00      NUMBER(19,0),
    C_IATTR01      NUMBER(19,0),
    C_IATTR02      NUMBER(19,0),
    C_IATTR03      NUMBER(19,0),
    C_IATTR04      NUMBER(19,0),
    C_IATTR05      NUMBER(19,0),
    C_IATTR06      NUMBER(19,0),
    C_IATTR07      NUMBER(19,0),
    C_IATTR08      NUMBER(19,0),
    C_IATTR09      NUMBER(19,0),
    C_IATTR10      NUMBER(19,0),
    C_IATTR11      NUMBER(19,0),
    C_IATTR12      NUMBER(19,0),
    C_IATTR13      NUMBER(19,0),
    C_IATTR14      NUMBER(19,0),
    C_IATTR15      NUMBER(19,0),
    C_IATTR16      NUMBER(19,0),
    C_IATTR17      NUMBER(19,0),
    C_IATTR18      NUMBER(19,0),
    C_IATTR19      NUMBER(19,0),
    PRIMARY KEY (C_ID)
);

--
-- FREQUENT_FLYER
--
CREATE TABLE FREQUENT_FLYER (
    FF_C_ID        NUMBER(19,0) NOT NULL REFERENCES CUSTOMER (C_ID),
    FF_AL_ID       NUMBER(19,0) NOT NULL REFERENCES AIRLINE (AL_ID),
    FF_C_ID_STR    VARCHAR2(64) NOT NULL,
    FF_SATTR00     VARCHAR2(32),
    FF_SATTR01     VARCHAR2(32),
    FF_SATTR02     VARCHAR2(32),
    FF_SATTR03     VARCHAR2(32),
    FF_IATTR00     NUMBER(19,0),
    FF_IATTR01     NUMBER(19,0),
    FF_IATTR02     NUMBER(19,0),
    FF_IATTR03     NUMBER(19,0),
    FF_IATTR04     NUMBER(19,0),
    FF_IATTR05     NUMBER(19,0),
    FF_IATTR06     NUMBER(19,0),
    FF_IATTR07     NUMBER(19,0),
    FF_IATTR08     NUMBER(19,0),
    FF_IATTR09     NUMBER(19,0),
    FF_IATTR10     NUMBER(19,0),
    FF_IATTR11     NUMBER(19,0),
    FF_IATTR12     NUMBER(19,0),
    FF_IATTR13     NUMBER(19,0),
    FF_IATTR14     NUMBER(19,0),
    FF_IATTR15     NUMBER(19,0),
   PRIMARY KEY (FF_C_ID, FF_AL_ID)
);
CREATE INDEX IDX_FF_CUSTOMER_ID ON FREQUENT_FLYER (FF_C_ID_STR);

--
-- FLIGHT
--
CREATE TABLE FLIGHT (
    F_ID            NUMBER(19,0) NOT NULL,
    F_AL_ID         NUMBER(19,0) NOT NULL REFERENCES AIRLINE (AL_ID),
    F_DEPART_AP_ID  NUMBER(19,0) NOT NULL REFERENCES AIRPORT (AP_ID),
    F_DEPART_TIME   TIMESTAMP NOT NULL,
    F_ARRIVE_AP_ID  NUMBER(19,0) NOT NULL REFERENCES AIRPORT (AP_ID),
    F_ARRIVE_TIME   TIMESTAMP NOT NULL,
    F_STATUS        NUMBER(19,0) NOT NULL,
    F_BASE_PRICE    FLOAT NOT NULL,
    F_SEATS_TOTAL   NUMBER(19,0) NOT NULL,
    F_SEATS_LEFT    NUMBER(19,0) NOT NULL,
    F_IATTR00       NUMBER(19,0),
    F_IATTR01       NUMBER(19,0),
    F_IATTR02       NUMBER(19,0),
    F_IATTR03       NUMBER(19,0),
    F_IATTR04       NUMBER(19,0),
    F_IATTR05       NUMBER(19,0),
    F_IATTR06       NUMBER(19,0),
    F_IATTR07       NUMBER(19,0),
    F_IATTR08       NUMBER(19,0),
    F_IATTR09       NUMBER(19,0),
    F_IATTR10       NUMBER(19,0),
    F_IATTR11       NUMBER(19,0),
    F_IATTR12       NUMBER(19,0),
    F_IATTR13       NUMBER(19,0),
    F_IATTR14       NUMBER(19,0),
    F_IATTR15       NUMBER(19,0),
    F_IATTR16       NUMBER(19,0),
    F_IATTR17       NUMBER(19,0),
    F_IATTR18       NUMBER(19,0),
    F_IATTR19       NUMBER(19,0),
    F_IATTR20       NUMBER(19,0),
    F_IATTR21       NUMBER(19,0),
    F_IATTR22       NUMBER(19,0),
    F_IATTR23       NUMBER(19,0),
    F_IATTR24       NUMBER(19,0),
    F_IATTR25       NUMBER(19,0),
    F_IATTR26       NUMBER(19,0),
    F_IATTR27       NUMBER(19,0),
    F_IATTR28       NUMBER(19,0),
    F_IATTR29       NUMBER(19,0),
    PRIMARY KEY (F_ID)
);
CREATE INDEX F_DEPART_TIME_IDX ON FLIGHT (F_DEPART_TIME);

--
-- RESERVATION
--
CREATE TABLE RESERVATION (
    R_ID            NUMBER(19,0) NOT NULL,
    R_C_ID          NUMBER(19,0) NOT NULL REFERENCES CUSTOMER (C_ID),
    R_F_ID          NUMBER(19,0) NOT NULL REFERENCES FLIGHT (F_ID),
    R_SEAT          NUMBER(19,0) NOT NULL,
    R_PRICE         FLOAT NOT NULL,
    R_IATTR00       NUMBER(19,0),
    R_IATTR01       NUMBER(19,0),
    R_IATTR02       NUMBER(19,0),
    R_IATTR03       NUMBER(19,0),
    R_IATTR04       NUMBER(19,0),
    R_IATTR05       NUMBER(19,0),
    R_IATTR06       NUMBER(19,0),
    R_IATTR07       NUMBER(19,0),
    R_IATTR08       NUMBER(19,0),
    UNIQUE (R_F_ID, R_SEAT),
    PRIMARY KEY (R_ID, R_C_ID, R_F_ID)
);